import java.sql.*;

public class DatabaseAccess extends Thread {
	Statement statement;
	
	public void run() { 
		int numInserts = 0;
		int numReads = 100;
		int numUpdates = 0;
		
		try {
			// Set up connection
			Connection con;
			String usernamestring = "basta";
			String passwordstring = "Surface22";
			String url = "jdbc:mysql://localhost:3306/mysql?useSSL=false";
			
			con = DriverManager.getConnection(url, usernamestring, passwordstring);
			statement = con.createStatement();
			
			for (int i=0; i<numInserts; i++) {
				createPayment((i%30)+1);
			}
			
			for (int i=0; i<numReads; i++) {
				getPayments((i%30)+1);
			}
			
			for (int i=0; i<numUpdates; i++) {
				updatePayment((i%30)+1);
			}
			
			statement.close();
			con.close();
		}
		catch (Exception e) {
			e.printStackTrace();
		}
    } 
	
	void getPayments(int accid) {		
		try {
			// Create query
			String querySQL = "SELECT accid, date, amount FROM payment WHERE accid = " + accid + ";";

			// Execute query
			java.sql.ResultSet rs = statement.executeQuery(querySQL);

			int count = 0;
			
			while (rs.next()) {
				count++;
			}
			System.out.println(count + " payments for accid " + accid + ".");
			
		} catch (SQLException e) {
			String sqlMessage = e.getMessage();
			System.out.println(sqlMessage);
		}
	}
	
	void createPayment(int accid) {
		Double amount = (double) ((int)(Math.random() * 100));
		String date = "2020-01-01";

		try {
			// Create insert string
			String insertSQL = "INSERT INTO payment VALUES (DEFAULT, \'" + date + "\', " + amount + ", " + accid + ");";

			// Execute insert
			statement.executeUpdate(insertSQL);
			
			// If no error
			// System.out.println("Successfully added payment for account with ID #" + accid + " on " + date + " for $" + amount + ".");
		} catch (SQLException e) {
			String sqlMessage = e.getMessage();
			System.out.println(sqlMessage);
			System.out.println();
		}
	}
	
	void updatePayment(int pid) {
		Double amount = (double) ((int)(Math.random() * 100));

		try {
			// Create insert string
			String updateSQL = "UPDATE payment SET amount = "+ amount + " WHERE pid = " + pid + ";";
			// Execute insert
			statement.executeUpdate(updateSQL);
			
			// If no error
			// System.out.println("Successfully updated payment with pid " + pid + " for $" + amount + ".");
		} catch (SQLException e) {
			String sqlMessage = e.getMessage();
			System.out.println(sqlMessage);
			System.out.println();
		}
	}
}
